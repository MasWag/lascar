#!/bin/bash

configure_options="$*"
prefix=`opam config var prefix`
debug=''
dotviewer='graphviz'

ocamlversion_min=4.06

# Parse command-line arguments

while : ; do
  case "$1" in
    "") break;;
    -dotviewer|--dotviewer)
        dotviewer=$2; shift;;
    -help|--help)
        cat <<EOF
Usage: configure [options]
Options: [defaults in brackets after descriptions]
  --dotviewer NAME        command name for displaying .dot files [default: open -a Graphviz]
  --help                  print this message
EOF
	exit 0;;
    *) echo "Unknown option \"$1\"." 1>&2; exit 2;;
  esac
  shift
done

# Generate the config file

rootdir=`dirname $0`

cd $rootdir
rm -f config
touch config

# Write options

echo "# generated by ./configure $configure_options" >> config

# checking for dot viewer 
set dummy $dotviewer; pgm_name=$2
/bin/echo -n "checking for program to view .dot files... "
if command -v "$pgm_name" >/dev/null 2>&1; then
   echo "$pgm_name"
   dotviewer=$pgm_name
else
   echo "not found"
   { echo "** configure: warning: cannot find $pgm_name." 1>&2; }
   dotviewer=''
fi

# Finish generated files

if [ -n "$dotviewer" ]; then
echo "DOTVIEWER=$dotviewer" >> config
fi

libdir=`opam config var lib`
docdir=`opam config var doc`

echo
echo "** Configuration summary **"
echo
echo "Directory where the distribution will be installed:"
echo "        library.................   $libdir"
echo "        documentation............. $docdir"
if [ -n "$dotviewer" ]; then
echo "Program for viewing .dot files: \"$dotviewer\""
fi
echo
echo "** Configuration completed successfully **"
echo "** Wrote files ./config"
echo
